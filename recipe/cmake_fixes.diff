diff --git a/CMakeLists.txt b/CMakeLists.txt
index f39b35a..e37fd5d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -56,18 +69,42 @@ add_test(test-marray test-marray)
 
 if(HDF5_FOUND)
     add_executable(test-hdf5 src/unittest/hdf5.cxx ${headers})
-    target_link_libraries(test-hdf5 ${HDF5_LIBRARIES})
+    if(TARGET hdf5-shared)
+      # NOTE: if the hdf5-shared target exists, it means that the NO_MODULE
+      # find_package() was successful. We just need to link the imported target
+      # and this will bring in the include dirs as well.
+      target_link_libraries(test-hdf5 hdf5-shared)
+    else()
+      # Otherwise, we use the CMake variables provided by the usual
+      # find_package() call.
+      target_include_directories(test-hdf5 PRIVATE ${HDF5_INCLUDE_DIRS})
+      target_link_libraries(test-hdf5 ${HDF5_LIBRARIES})
+    endif()
     add_test(test-hdf5 test-hdf5)
+    FIND_PACKAGE(Threads REQUIRED)
 
     add_executable(test-marray-hdf5 src/unittest/marray-hdf5.cxx ${headers})
-    target_link_libraries(test-marray-hdf5 ${HDF5_LIBRARIES})
+    if(TARGET hdf5-shared)
+      target_link_libraries(test-marray-hdf5 hdf5-shared)
+    else()
+      target_include_directories(test-marray-hdf5 PRIVATE ${HDF5_INCLUDE_DIRS})
+      target_link_libraries(test-marray-hdf5 ${HDF5_LIBRARIES})
+    endif()
     add_test(test-marray-hdf5 test-marray-hdf5)
 
     add_executable(tutorial-marray-hdf5 src/tutorial/tutorial-hdf5.cxx ${headers})
-    target_link_libraries(tutorial-marray-hdf5 ${HDF5_LIBRARIES})
+    if(TARGET hdf5-shared)
+      target_link_libraries(tutorial-marray-hdf5 hdf5-shared)
+    else()
+      target_include_directories(tutorial-marray-hdf5 PRIVATE ${HDF5_INCLUDE_DIRS})
+      target_link_libraries(tutorial-marray-hdf5 ${HDF5_LIBRARIES})
+    endif()
 endif()
 
 if(DOXYGEN_FOUND)
     configure_file("${marray_SOURCE_DIR}/doxygen/Doxyfile.in" "${marray_BINARY_DIR}/Doxyfile" @ONLY IMMEDIATE)
     add_custom_target(doc-marray ALL COMMAND ${DOXYGEN} "${marray_BINARY_DIR}/Doxyfile")
 endif()
+
+# Install the headers.
+install(DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/include/andres" DESTINATION include)
